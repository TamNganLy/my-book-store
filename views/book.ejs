<section class="detail-container">
  <div class="book-container">
    <ul class="row">
        <li class="col-lg-2 col-3"></li>
        <li class="col-lg-8 col-7">
          <div class="book-category">
            <p><a href="/">HOME</a></p>
            -
            <p><a href="/"><%= book.genre %></a></p>
            -
            <p><%= book.title %></p>
          </div>
        </li>
      </ul>
    
    <ul class="row">
        <li class="col-lg-2 col-3"></li>
        <li class="col-lg-4 col-8">
          <div class="book-cover">
            <img
              src="https://covers.openlibrary.org/b/isbn/<%= book.id %>-L.jpg"
              alt="<%= book.title %>"
            />
          </div>
        </li>
        <li class="col-lg-4 col-12 info">
          <h1 class="book-detail-title" id="title<%=book.id%>"><%= book.title %></h1>
          <p class="book-detail-author" 
          id="author<%= book.id %>"><%= book.author ? `By ${book.author}` : "" %></p>
          <p class="book-detail-description" id="description<%=book.id%>"><%= book.description %></p>
          <p class="book-detail-rate" 
          id="rate<%=book.id%>">Rate: <%= book.rate %>/5</p>

          <form action="/isbn/<%=book.id%>/edit-book" method="POST">
            <input 
              class="input input-book"
              id="updatedTitle<%=book.id%>" 
              type="text" 
              name="updatedTitle" 
              value="<%= book.title %>" 
              autocomplete="off"
              autofocus="true" 
              hidden="true" />

            <input 
              class="input input-book"
              id="updatedAuthor<%=book.id%>" 
              type="text" 
              name="updatedAuthor" 
              value="<%= book.author %>" 
              autocomplete="off"
              autofocus="true" 
              hidden="true" />

            <textarea 
              class="input input-book"
              id="updatedDescription<%=book.id%>" 
              type="text" 
              name="updatedDescription"
              rows="15" 
              autocomplete="off"
              autofocus="true" 
              hidden="true"
            ><%= book.description %></textarea>

            <select 
              class="input input-book input-rate" 
              id="updatedRate<%=book.id%>"  
              name="updatedRate" 
              autocomplete="off"
              hidden
            >
              <option value="1" <%= book.rate == 1 ? "selected" : "" %>>1</option>
              <option value="2" <%= book.rate == 2 ? "selected" : "" %>>2</option>
              <option value="3" <%= book.rate == 3 ? "selected" : "" %>>3</option>
              <option value="4" <%= book.rate == 4 ? "selected" : "" %>>4</option>
              <option value="5" <%= book.rate == 5 ? "selected" : "" %>>5</option>
            </select>

            <br id="break<%=book.id%>" hidden/>
            <div class="btn-update-container" id="btn<%=book.id%>" hidden>
              <button class="btn-update" id="done<%=book.id%>" type="submit">
                <img width="30" src="/images/yes.png" alt="tick image" />
              </button>
              <button class="btn-update" id="cancel<%=book.id%>" type="button"  onclick="handler_cancel_book('<%=book.id%>')">
                <img width="30" src="/images/no.png" alt="x image" />
              </button>
            </div>
          </form>

         <div class="btn-container">
           <button class="btn btn-primary" id="edit<%=book.id%>" onclick="handler_book('<%=book.id%>')">
            Edit
          </button>

          <form action="/isbn/<%=book.id%>/delete-book" method="POST">
            <button class="btn btn-primary" type="submit" >Delete</button>
          </form>
         </div>
        </li>
        <li class="col-lg-2 col-2"></li>
      </ul>
  </div>

  <div class="review-container">
    <div class="review-item">
      <h2>Reviews</h2>

      <% if (locals.reviews.length > 0) { %>
      <ul>
        <% reviews.forEach(review => { %>
        <li class="review">
          <p id="text<%=review.id%>"><%= review.text %></p>

          <form action="/isbn/<%=book.id%>/edit-review" method="POST">
            <input type="hidden" name="id" value="<%= review.id %>">
            <textarea 
              class="input"
              id="input<%=review.id%>" 
              type="text" 
              name="updatedReview" 
              rows="2" 
              autocomplete="off"
              autofocus="true" 
              hidden="true"><%= review.text %></textarea>
              <br id="break<%=review.id%>" hidden/>
            <div class="btn-update-container" id="btn<%=review.id%>" hidden>
              <button class="btn-update" id="done<%=review.id%>" type="submit">
                <img width="30" src="/images/yes.png" alt="tick image" />
              </button>
              <button class="btn-update" id="cancel<%=review.id%>" type="button" onclick="handler_cancel('<%=review.id%>')">
                <img width="30" src="/images/no.png" alt="x image" />
              </button>
            </div>
          </form>

          <div class="btn-update-container">
            <button class="btn-review" id="edit<%=review.id%>" onclick="handler('<%=review.id%>')">
            Edit
          </button>
          <form action="/isbn/<%=book.id%>/delete-review" method="POST">
            <input type="hidden" name="id" value="<%= review.id %>">
            <button class="btn-review" type="submit" >Delete</button>
          </form>
          </div>
        </li>
        <% }) %>
      </ul>
      <% } else { %>
      <p><%= reviewMessage || "No reviews yet." %></p>
      <% } %>
    </div>

    <div class="review-item">
      <h2>Add a review</h2>
      <div class="form">
        <form action="/isbn/<%=book.id%>/add-review" method="POST" >
          <input type="hidden" name="isbn" value="<%= book.id %>">
          <label for="review">Your review *</label>
          <textarea class="input" type="text" name="review" id="review" rows="2" required ></textarea>
          <br />
          <div class="form-btn">
            <input class="btn btn-secondary" type="submit" value="Save" />
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
